# 图解HTTP
## HTTP的诞生
HTTP/1.0
http://www.ietf.org/rfc/rfc1945.txt
1.1 2.0

### TCP/IP 的分层管理
TCP/IP 协议族里重要的一点就是分层。TCP/IP 协议族按层次分别分为以下 4 层：应用层、传输层、网络层和数据链路层。  
- 应用层: HTTP FTP DNS
- 传输层: 在传输层有两个性质不同的协议：TCP（Transmission Control Protocol，传输控制协议）和 UDP（User Data Protocol，用户数据报协议）
- 网络层（又名网络互连层）: 网络层用来处理在网络上流动的数据包。IP（Internet Protocol）网际协议位于网络层。
- 链路层（又名数据链路层，网络接口层）: 用来处理连接网络的硬件部分。包括控制操作系统、硬件的设备驱动、NIC（Network Interface Card，网络适配器，即网卡），及光纤等物理可见部分（还包括连接器等一切传输媒介）。硬件上的范畴均在链路层的作用范围之内。

### 与 HTTP 关系密切的协议 : IP、TCP 和 DNS
IP 协议的作用是把各种数据包传送给对方。而要保证确实传送到对方那里，则需要满足各类条件。其中两个重要的条件是 IP 地址和 MAC 地址（Media Access Control Address）。  
IP 地址指明了节点被分配到的地址，MAC 地址是指网卡所属的固定地址。

### 确保可靠性的 TCP 协议
TCP 协议采用了三次握手（three-way handshaking）  
1. 发送端首先发送一个带 SYN 标志的数据包给对方。
2. 接收端收到后，回传一个带有 SYN/ACK 标志的数据包以示传达确认信息。
3. 最后，发送端再回传一个带 ACK 标志的数据包，代表“握手”结束。

### 负责域名解析的 DNS 服务
DNS 协议提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务。

## HTTP 协议用于客户端和服务器端之间的通信
### 通过请求和响应的交换达成通信
请求报文的构成: 
- 协议版本
- 状态码
- 状态码短语
- 首部
- 主体

### HTTP 是不保存状态的协议
HTTP/1.1引入了 Cookie保持状态

### HTTP 方法

| 方法 | 说明 | 支持的 HTTP 协议版本 |
|---|---|---|
|GET|	获取资源|	1.0、1.1|
|POST|	传输实体主体|	1.0、1.1|
|PUT|	传输文件|	1.0、1.1|
|HEAD	|获得报文首部|	1.0、1.1|
|DELETE|	删除文件|	1.0、1.1|
|OPTIONS|	询问支持的方法|	1.1|
|TRACE|	追踪路径|	1.1|
|CONNECT|	要求用隧道协议连接代理	| 1.1|

### 持久连接
持久连接的特点是，只要任意一端没有明确提出断开连接  
在 HTTP/1.1 中，所有的连接默认都是持久连接  

### 管线化
同时并行发送多个请求，而不需要一个接一个地等待响应了。

### 使用 Cookie 的状态管理
Cookie 技术通过在请求和响应报文中写入 Cookie 信息来控制客户端的状态。  
Cookie 会根据从服务器端发送的响应报文内的一个叫做 Set-Cookie 的首部字段信息，通知客户端保存 Cookie。当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入 Cookie 值后发送出去。

## HTTP 报文内的 HTTP 信息
用于 HTTP 协议交互的信息被称为 HTTP 报文。请求端（客户端）的 HTTP 报文叫做请求报文，响应端（服务器端）的叫做响应报文。HTTP 报文本身是由多行（用 CR+LF 作换行符）数据构成的字符串文本。

HTTP 报文大致可分为报文首部和报文主体两块。两者由最初出现的空行（CR+LF）来划分。通常，并不一定要有报文主体。

### 发送多种数据的多部分对象集合
多部分对象集合包含的对象如下。multipart/form-data， 在 Web 表单文件上传时使用。

multipart/byteranges

状态码 206（Partial Content，部分内容）响应报文包含了多个范围的内容时使用。

### 获取部分内容的范围请求
指定范围发送的请求叫做范围请求（Range Request）。
```
# Request
Range: bytes=5001-10000

# Response
HTTP/1.1 206 Partial Content 
Content-Range: bytes 5001-10000
```
如果服务器端无法响应范围请求，则会返回状态码 200 OK 和完整的实体内容。

### 内容协商返回最合适的内容
内容协商机制是指客户端和服务器端就响应的资源内容进行交涉，然后提供给客户端最为适合的资源。内容协商会以响应资源的语言、字符集、编码方式等作为判断的基准。  
包含在请求报文中的某些首部字段（如下）就是判断的基准。这些首部字段的详细说明请参考下一章。
- Accept
- Accept-Charset
- Accept-Encoding
- Accept-Language
- Content-Language

## 返回结果的 HTTP 状态码

| |类别|原因短语|
|---|---|---|
|1XX|	Informational（信息性状态码）|	接收的请求正在处理|
|2XX|	Success（成功状态码）|	请求正常处理完毕|
|3XX|	Redirection（重定向状态码）|	需要进行附加操作以完成请求|
|4XX|	Client Error（客户端错误状态码）|	服务器无法处理请求|
|5XX|	Server Error（服务器错误状态码）|	服务器处理请求出错|

## 与 HTTP 协作的 Web 服务器
用单台虚拟主机实现多个域名  
通信数据转发程序：代理、网关、隧道  
保存资源的缓存：缓存的有效期限。存不仅可以存在于缓存服务器内，还可以存在客户端浏览器中。

## HTTP 首部
### HTTP 首部字段
HTTP 首部字段是由首部字段名和字段值构成的，中间用冒号“:” 分隔。`首部字段名: 字段值`  

4 种 HTTP 首部字段类型:
- 通用首部字段（General Header Fields）请求报文和响应报文两方都会使用的首部。

- 请求首部字段（Request Header Fields）从客户端向服务器端发送请求报文时使用的首部。补充了请求的附加内容、客户端信息、响应内容相关优先级等信息。

- 响应首部字段（Response Header Fields）从服务器端向客户端返回响应报文时使用的首部。补充了响应的附加内容，也会要求客户端附加额外的内容信息。

- 实体首部字段（Entity Header Fields） 针对请求报文和响应报文的实体部分使用的首部。补充了资源内容更新时间等与实体有关的信息。

`Cache-Control`能够控制缓存的行为  
`Connection`控制代理不再转发的首部字段，管理持久连接。  
`Accept`Accept 首部字段可通知服务器，用户代理能够处理的媒体类型及媒体类型的相对优先级。  
`Accept-Charset`符集及字符集的相对优先顺序  
`Accept-Encoding`内容编码及内容编码的优先级顺序  

为 Cookie 服务的首部字段

|首部字段名|	说明|	首部类型|
|---|---|---|
|Set-Cookie|	开始状态管理所使用的Cookie信息|	响应首部字段|
|Cookie|	服务器接收到的Cookie信息|	请求首部字段|

## 确保 Web 安全的 HTTPS
